# Diagrammes visuels : Architecture ServiceStatus

## ğŸ¯ Comparaison visuelle avant/aprÃ¨s

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      AVANT (Frontend - Lent)                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘  [Navigateur]                                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚ ServiceStatus.jsx                                                 â”‚  â•‘
â•‘  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â•‘
â•‘  â”‚ â”‚ useServiceData()                                             â”‚  â”‚  â•‘
â•‘  â”‚ â”‚                                                              â”‚  â”‚  â•‘
â•‘  â”‚ â”‚  1. API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚     â†“ 500KB (5000 actions)                            â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚  2. Filtrer dates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚     â†“ 150ms (itÃ©ration complÃ¨te)               â”‚   â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚  3. Classifier actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚     â†“ 300ms (5000Ã— appels fonction)         â”‚   â”‚   â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚  4. AgrÃ©ger temps â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚   â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚     â†“ 100ms                          â”‚      â”‚   â”‚   â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚  5. Calculer charge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚      â”‚   â”‚   â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚     â†“ 5ms                      â”‚     â”‚      â”‚   â”‚   â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚  6. Top 10 FRAG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚      â”‚   â”‚   â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚     â†“ 100ms                â”‚   â”‚     â”‚      â”‚   â”‚   â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚  7. Consommation sites  â”   â”‚   â”‚     â”‚      â”‚   â”‚   â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚     â†“ 200ms (3 boucles) â”‚   â”‚   â”‚     â”‚      â”‚   â”‚   â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚  8. Couleurs/textes  â”  â”‚   â”‚   â”‚     â”‚      â”‚   â”‚   â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚     â†“ 50ms          â”‚   â”‚   â”‚   â”‚     â”‚      â”‚   â”‚   â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚                      â”‚   â”‚   â”‚   â”‚     â”‚      â”‚   â”‚   â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚  âœ… Affichage        â”‚   â”‚   â”‚   â”‚     â”‚      â”‚   â”‚   â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚     â†“ 100ms         â”‚   â”‚   â”‚   â”‚     â”‚      â”‚   â”‚   â”‚     â”‚  â”‚  â•‘
â•‘  â”‚ â”‚                      â–¼   â–¼   â–¼   â–¼     â–¼      â–¼   â–¼   â–¼     â–¼  â”‚  â•‘
â•‘  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘  â”‚                                                                       â”‚  â•‘
â•‘  â”‚ TOTAL : ~1000-2000ms  âŒ LAG utilisateur                            â”‚  â•‘
â•‘  â”‚ MÃ©moire : 100MB       âŒ Batterie tÃ©lÃ©phone                         â”‚  â•‘
â•‘  â”‚ RÃ©seau : 500KB        âŒ Slow network                               â”‚  â•‘
â•‘  â”‚ CPU : 30-40%          âŒ Chauffe device                             â”‚  â•‘
â•‘  â”‚                                                                       â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      APRÃˆS (Backend - Rapide)                             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘  [Serveur]                        [Navigateur]                            â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚ ServiceMetricsController     â”‚ â”‚ ServiceStatus.jsx               â”‚   â•‘
â•‘  â”‚                              â”‚ â”‚                                 â”‚   â•‘
â•‘  â”‚  GET /api/service/metrics    â”‚ â”‚ useServiceMetrics()             â”‚   â•‘
â•‘  â”‚  â”œâ”€ Filtrer dates (SQL) â”    â”‚ â”‚                                 â”‚   â•‘
â•‘  â”‚  â”‚  â†“ 50ms             â”‚    â”‚ â”‚ 1. API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â•‘
â•‘  â”‚  â”œâ”€ Classifier actions â”œâ”€â”€â”€â”€â”¤ â”‚    â†“ 5KB                 â”‚     â”‚   â•‘
â•‘  â”‚  â”‚  â†“ 100ms            â”‚    â”‚ â”‚ 2. Affichage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚   â•‘
â•‘  â”‚  â”œâ”€ AgrÃ©ger (SQL) â”    â”‚    â”‚ â”‚    â†“ 50ms             â”‚ â”‚     â”‚   â•‘
â•‘  â”‚  â”‚  â†“ 20ms       â”‚    â”‚    â”‚ â”‚                        â”‚ â”‚     â”‚   â•‘
â•‘  â”‚  â”œâ”€ Charge ratio â”œâ”€â”€â”€â”€â”¤    â”‚ â”‚ TOTAL : ~300-400ms     â”‚ â”‚     â”‚   â•‘
â•‘  â”‚  â”‚  â†“ 2ms        â”‚    â”‚    â”‚ â”‚ MÃ©moire : 1MB          â”‚ â”‚     â”‚   â•‘
â•‘  â”‚  â”œâ”€ Top 10 FRAG â”œâ”€â”€â”€â”€â”¤    â”‚ â”‚ RÃ©seau : 5KB           â”‚ â”‚     â”‚   â•‘
â•‘  â”‚  â”‚  â†“ 30ms       â”‚    â”‚    â”‚ â”‚ CPU : 1-2%             â”‚ â”‚     â”‚   â•‘
â•‘  â”‚  â”œâ”€ Sites (SQL) â”œâ”€â”€â”€â”€â”¤    â”‚ â”‚                        â”‚ â”‚     â”‚   â•‘
â•‘  â”‚  â”‚  â†“ 60ms       â”‚    â”‚    â”‚ â”‚ âœ… Pas de lag         â”‚ â”‚     â”‚   â•‘
â•‘  â”‚  â”œâ”€ Format JSON â”œâ”€â”€â”€â”€â”¼â”€â”€â†’ â”‚ â”‚ âœ… Battery friendly   â”‚ â”‚     â”‚   â•‘
â•‘  â”‚  â”‚  â†“ 10ms       â”‚    â”‚    â”‚ â”‚ âœ… Scalable           â”‚ â”‚     â”‚   â•‘
â•‘  â”‚  â”‚               â”‚    â”‚    â”‚ â”‚ âœ… Cool device        â”‚ â”‚     â”‚   â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚ â”‚                      â–¼ â”‚     â”‚   â•‘
â•‘  â”‚                       â–¼    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â•‘
â•‘  â”‚ TOTAL : ~200-300ms         â”‚                              â”‚   â•‘
â•‘  â”‚ (ParallÃ©lisÃ© en SQL)        â”‚                              â”‚   â•‘
â•‘  â”‚                             â”‚                              â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚   â•‘
â•‘         â”‚                                                      â”‚   â•‘
â•‘         â”‚ JSON {                                              â”‚   â•‘
â•‘         â”‚   chargePercent: 78.5,        âœ… PRÃ‰-CALCULÃ‰       â”‚   â•‘
â•‘         â”‚   timeBreakdown: {...},       âœ… PRÃ‰-FORMATÃ‰       â”‚   â•‘
â•‘         â”‚   fragmentation: {...},       âœ… PRÃ‰-TRIÃ‰          â”‚   â•‘
â•‘         â”‚   siteConsumption: {...}      âœ… PRÃ‰-AGRÃ‰GÃ‰        â”‚   â•‘
â•‘         â”‚ }                                                    â”‚   â•‘
â•‘         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â•‘
â•‘                                                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ“Š Timeline comparatif (millisecondes)

```
AVANT (Frontend)                              APRÃˆS (Backend)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

0ms   DÃ©but                                   0ms   DÃ©but
â”‚                                             â”‚
â”œâ”€ 50ms RequÃªte HTTP                         â”œâ”€ 50ms RequÃªte HTTP
â”‚       (Send)                                â”‚      (Send)
â”‚
â”œâ”€ 800ms Transfert 500KB rÃ©seau             â”œâ”€ 20ms Transfert 5KB rÃ©seau
â”‚        (Slow network)                      â”‚       (Ultra rapide)
â”‚
â”œâ”€ 200ms Parsing JSON                        â”œâ”€ 50ms Filtrage SQL
â”‚        5000 objets                         â”‚       (Index utilisÃ©)
â”‚
â”œâ”€ 150ms Filtrage dates                      â”œâ”€ 100ms Classification
â”‚        (5000Ã— comparaisons)                â”‚       (Logique mÃ©tier)
â”‚
â”œâ”€ 300ms Classification actions              â”œâ”€ 20ms AgrÃ©gation SQL
â”‚        (5000Ã— appels fonction)             â”‚       (GROUP BY)
â”‚
â”œâ”€ 100ms AgrÃ©gation temps                    â”œâ”€ 2ms Calcul ratio charge
â”‚        (Simple mais volumineux)            â”‚      (O(1))
â”‚
â”œâ”€ 5ms Calcul charge ratio                   â”œâ”€ 10ms Actions courtes %
â”‚                                             â”‚
â”œâ”€ 80ms Pourcentage actions courtes          â”œâ”€ 30ms Top 10 FRAG
â”‚       (1 itÃ©ration + calculs)              â”‚       (SQL + sorting)
â”‚
â”œâ”€ 100ms Top 10 FRAG                         â”œâ”€ 60ms Consommation sites
â”‚        (Filter + Group + Sort)             â”‚       (SQL + JOIN)
â”‚
â”œâ”€ 200ms Consommation par site               â”œâ”€ 20ms Formatage JSON
â”‚        (3 itÃ©rations, 4 levels deep)       â”‚       (PrÃªt Ã  envoyer)
â”‚
â”œâ”€ 50ms Couleurs et textes                   â”œâ”€ 20ms Parsing au frontend
â”‚       (AccÃ¨s thresholds)                   â”‚       (Petit JSON)
â”‚
â”œâ”€ 100ms Rendu React                         â”œâ”€ 100ms Rendu React
â”‚        (Mise Ã  jour DOM)                   â”‚        (Mise Ã  jour DOM)
â”‚
â””â”€2000ms TOTAL                               â”œâ”€ 50ms Affichage couleurs
                                             â”‚       (AccÃ¨s directe)
                                             â”‚
                                             â””â”€400ms TOTAL

GAIN : 5x plus rapide ! ğŸš€
```

---

## ğŸ”„ Flux de donnÃ©es dÃ©taillÃ©

### AVANT (JavaScript lourd)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       NAVIGATEUR                                â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ API : actions.fetchActions()                            â”‚ â”‚
â”‚   â”‚                                                          â”‚ â”‚
â”‚   â”‚ Retourne : [                                            â”‚ â”‚
â”‚   â”‚   {                                                     â”‚ â”‚
â”‚   â”‚     id: 1,                                             â”‚ â”‚
â”‚   â”‚     timeSpent: 2.5,                                    â”‚ â”‚
â”‚   â”‚     subcategory: { id: 5, name: "Support" },          â”‚ â”‚
â”‚   â”‚     intervention: {                                   â”‚ â”‚
â”‚   â”‚       id: 100,                                        â”‚ â”‚
â”‚   â”‚       date: "2024-01-15",                             â”‚ â”‚
â”‚   â”‚       machine: {                                      â”‚ â”‚
â”‚   â”‚         id: 50,                                       â”‚ â”‚
â”‚   â”‚         name: "M50",                                  â”‚ â”‚
â”‚   â”‚         is_mere: true,                                â”‚ â”‚
â”‚   â”‚         equipement_mere: null                         â”‚ â”‚
â”‚   â”‚       }                                               â”‚ â”‚
â”‚   â”‚     }                                                 â”‚ â”‚
â”‚   â”‚   },                                                   â”‚ â”‚
â”‚   â”‚   ... Ã— 5000 more                                      â”‚ â”‚
â”‚   â”‚ ]                                                      â”‚ â”‚
â”‚   â”‚                                                        â”‚ â”‚
â”‚   â”‚ Taille : ~500KB (!!!)                                 â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â”‚                                        â”‚
â”‚                      â–¼                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ FILTRAGE dates                                          â”‚ â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚   â”‚ allActions.filter(a => a.created_at >= startDate &&   â”‚ â”‚
â”‚   â”‚                         a.created_at <= endDate)       â”‚ â”‚
â”‚   â”‚                                                         â”‚ â”‚
â”‚   â”‚ âš ï¸ 5000 itÃ©rations                                     â”‚ â”‚
â”‚   â”‚ âš ï¸ Parse date pour chaque                              â”‚ â”‚
â”‚   â”‚ âš ï¸ 4 fallback fields par action                        â”‚ â”‚
â”‚   â”‚                                                         â”‚ â”‚
â”‚   â”‚ RÃ©sultat : [... 4500 actions]                         â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â”‚                                        â”‚
â”‚                      â–¼                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ CLASSIFICATION actions                                  â”‚ â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚   â”‚ actionsData.map(a => ({                               â”‚ â”‚
â”‚   â”‚   ...a,                                               â”‚ â”‚
â”‚   â”‚   timeType: classifyActionTime(a)  // PROD/DEP/...    â”‚ â”‚
â”‚   â”‚ }))                                                    â”‚ â”‚
â”‚   â”‚                                                         â”‚ â”‚
â”‚   â”‚ âš ï¸ 4500Ã— appels fonction                             â”‚ â”‚
â”‚   â”‚ âš ï¸ Chaque call = 5+ opÃ©rations                        â”‚ â”‚
â”‚   â”‚ âš ï¸ CrÃ©e 4500 nouveaux objets (spread)               â”‚ â”‚
â”‚   â”‚                                                         â”‚ â”‚
â”‚   â”‚ RÃ©sultat : [{ ...action, timeType: 'PROD' }, ...]   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â”‚                                        â”‚
â”‚                      â–¼                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ AGRÃ‰GATION par type                                     â”‚ â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚   â”‚ actions.forEach(a => {                                â”‚ â”‚
â”‚   â”‚   breakdown[a.timeType] += a.timeSpent               â”‚ â”‚
â”‚   â”‚ })                                                     â”‚ â”‚
â”‚   â”‚                                                         â”‚ â”‚
â”‚   â”‚ âš ï¸ 4500 itÃ©rations                                    â”‚ â”‚
â”‚   â”‚                                                         â”‚ â”‚
â”‚   â”‚ RÃ©sultat : {                                          â”‚ â”‚
â”‚   â”‚   PROD: 240.5,                                        â”‚ â”‚
â”‚   â”‚   DEP: 80.2,                                          â”‚ â”‚
â”‚   â”‚   PILOT: 120.1,                                       â”‚ â”‚
â”‚   â”‚   FRAG: 45.3,                                         â”‚ â”‚
â”‚   â”‚   total: 486.1                                        â”‚ â”‚
â”‚   â”‚ }                                                      â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â”‚                                        â”‚
â”‚                      â–¼                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ TOP 10 FRAGMENTATION                                    â”‚ â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚   â”‚ 1. Filter FRAG (500 actions)                         â”‚ â”‚
â”‚   â”‚ 2. Group par subcategory (20 catÃ©gories)            â”‚ â”‚
â”‚   â”‚ 3. Sort desc (20 items)                             â”‚ â”‚
â”‚   â”‚ 4. Slice 10 premiers                                 â”‚ â”‚
â”‚   â”‚ 5. Calculate percentages                             â”‚ â”‚
â”‚   â”‚                                                         â”‚ â”‚
â”‚   â”‚ RÃ©sultat : [                                          â”‚ â”‚
â”‚   â”‚   { id: 5, name: "Support", totalHours: 15.5, ... }, â”‚ â”‚
â”‚   â”‚   ...Ã— 10                                             â”‚ â”‚
â”‚   â”‚ ]                                                      â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â”‚                                        â”‚
â”‚                      â–¼                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ CONSOMMATION PAR SITE                                   â”‚ â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚   â”‚ 1. ItÃ©ration 1 : Group par equipment                 â”‚ â”‚
â”‚   â”‚    â””â”€ 4500 actions Ã— traversal profond              â”‚ â”‚
â”‚   â”‚ 2. ItÃ©ration 2 : Calculate totalServiceHours        â”‚ â”‚
â”‚   â”‚    â””â”€ 4500 actions                                   â”‚ â”‚
â”‚   â”‚ 3. ItÃ©ration 3 : Calculate totalFragHours           â”‚ â”‚
â”‚   â”‚    â””â”€ 4500 actions                                   â”‚ â”‚
â”‚   â”‚ 4. Ajouter percentages (50 sites)                    â”‚ â”‚
â”‚   â”‚ 5. Trier par FRAG                                     â”‚ â”‚
â”‚   â”‚                                                         â”‚ â”‚
â”‚   â”‚ âš ï¸ 3 Ã— 4500 itÃ©rations = 13500 opÃ©rations           â”‚ â”‚
â”‚   â”‚                                                         â”‚ â”‚
â”‚   â”‚ RÃ©sultat : [                                          â”‚ â”‚
â”‚   â”‚   { equipmentId: 1, ... , percentFrag: 44.6 },       â”‚ â”‚
â”‚   â”‚   ...Ã— 50                                             â”‚ â”‚
â”‚   â”‚ ]                                                      â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â”‚                                        â”‚
â”‚                      â–¼                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ CALCULS D'AFFICHAGE                                     â”‚ â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚   â”‚ - chargePercent = (486.1 / 960) Ã— 100 = 50.6%        â”‚ â”‚
â”‚   â”‚ - fragPercent = (45.3 / 486.1) Ã— 100 = 9.3%          â”‚ â”‚
â”‚   â”‚ - pilotPercent = (120.1 / 486.1) Ã— 100 = 24.7%       â”‚ â”‚
â”‚   â”‚ - chargeColor = getChargeColor(50.6) = 'orange'      â”‚ â”‚
â”‚   â”‚ - fragColor = getFragmentationColor(9.3) = 'green'   â”‚ â”‚
â”‚   â”‚ - ...                                                  â”‚ â”‚
â”‚   â”‚                                                         â”‚ â”‚
â”‚   â”‚ RÃ©sultat : PrÃªt pour SynthesisCards, etc.           â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â”‚                                        â”‚
â”‚                      â–¼                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ RENDU REACT                                             â”‚ â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚   â”‚ <SynthesisCards chargePercent={50.6} ... />           â”‚ â”‚
â”‚   â”‚ <TimeBreakdownSection timeBreakdown={...} />          â”‚ â”‚
â”‚   â”‚ <FragmentationCausesList fragmentation={...} />       â”‚ â”‚
â”‚   â”‚ <SiteConsumptionTable siteConsumption={...} />        â”‚ â”‚
â”‚   â”‚                                                         â”‚ â”‚
â”‚   â”‚ âœ… Utilisateur voit enfin le rÃ©sultat                 â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â”‚                                        â”‚
â”‚                      â–¼                                        â”‚
â”‚                  AFFICHAGE                                   â”‚
â”‚                  (2000ms aprÃ¨s clic)                         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### APRÃˆS (SQL rapide)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SERVEUR                                  â”‚ NAVIGATEUR                 â”‚
â”‚                                          â”‚                            â”‚
â”‚ GET /api/service/metrics?...             â”‚ useServiceMetrics()        â”‚
â”‚ â”‚                                        â”‚ â”‚                          â”‚
â”‚ â”œâ”€ SQL: SELECT * FROM actions           â”‚ â”œâ”€ Fetch API               â”‚
â”‚ â”‚        WHERE created_at >= ? AND ...   â”‚ â”‚                          â”‚
â”‚ â”‚        50ms (Index utilisÃ©)            â”‚ â”œâ”€ Parsing JSON            â”‚
â”‚ â”‚                                        â”‚ â”‚ 20ms (5KB)               â”‚
â”‚ â”œâ”€ Classification (CODE)                â”‚ â”‚                          â”‚
â”‚ â”‚  forEach action: classifyActionTime()  â”‚ â”œâ”€ setState() avec data    â”‚
â”‚ â”‚  100ms                                 â”‚ â”‚                          â”‚
â”‚ â”‚                                        â”‚ â””â”€â–º useEffect dÃ©clenchÃ©    â”‚
â”‚ â”œâ”€ SQL: SELECT SUM(...) CASE WHEN ...    â”‚     â”‚                     â”‚
â”‚ â”‚        GROUP BY time_type              â”‚     â”œâ”€ Rendu SynthesisCards â”‚
â”‚ â”‚        20ms                            â”‚     â”œâ”€ Rendu TimeBreakdown â”‚
â”‚ â”‚                                        â”‚     â”œâ”€ Rendu Fragmentation â”‚
â”‚ â”œâ”€ SQL: SELECT ... GROUP BY subcategory â”‚     â””â”€ Rendu SiteConsumption
â”‚ â”‚        ORDER BY SUM(time_spent) DESC   â”‚                            â”‚
â”‚ â”‚        LIMIT 10                        â”‚     âœ… Utilisateur voit    â”‚
â”‚ â”‚        30ms                            â”‚        le rÃ©sultat (400ms)  â”‚
â”‚ â”‚                                        â”‚                            â”‚
â”‚ â”œâ”€ SQL: SELECT ... GROUP BY equipment   â”‚                            â”‚
â”‚ â”‚        JOIN machines, interventions    â”‚                            â”‚
â”‚ â”‚        ORDER BY ...                    â”‚                            â”‚
â”‚ â”‚        60ms                            â”‚                            â”‚
â”‚ â”‚                                        â”‚                            â”‚
â”‚ â”œâ”€ Format JSON response                  â”‚                            â”‚
â”‚ â”‚  10ms                                  â”‚                            â”‚
â”‚ â”‚                                        â”‚                            â”‚
â”‚ â””â”€â–º RETURN {                             â”‚                            â”‚
â”‚     chargePercent: 50.6,                 â”‚                            â”‚
â”‚     timeBreakdown: {...},                â”‚                            â”‚
â”‚     fragmentation: {...},                â”‚                            â”‚
â”‚     siteConsumption: {...}               â”‚                            â”‚
â”‚   }                                      â”‚                            â”‚
â”‚   ~5KB                                   â”‚                            â”‚
â”‚                                          â”‚                            â”‚
â”‚ TOTAL BACKEND : 270ms                    â”‚                            â”‚
â”‚ (ParallÃ©lisÃ© en SQL)                     â”‚                            â”‚
â”‚                                          â”‚                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Comparaison Volume de donnÃ©es

```
AVANT (Frontend)                    APRÃˆS (Backend)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

API Transfert :                     API Transfert :
â””â”€ 5000 actions                     â””â”€ JSON mÃ©tadonnÃ©es
   â”œâ”€ id                               â”œâ”€ chargePercent: 50.6
   â”œâ”€ timeSpent                        â”œâ”€ timeBreakdown:
   â”œâ”€ createdAt                        â”‚  â”œâ”€ PROD: 240.5
   â”œâ”€ subcategory                      â”‚  â”œâ”€ DEP: 80.2
   â”‚  â”œâ”€ id                            â”‚  â”œâ”€ PILOT: 120.1
   â”‚  â”œâ”€ name                          â”‚  â”œâ”€ FRAG: 45.3
   â”‚  â””â”€ category                      â”‚  â””â”€ total: 486.1
   â”‚     â”œâ”€ id                         â”œâ”€ shortActionsPercent: 4.2
   â”‚     â”œâ”€ name                       â”œâ”€ fragmentation:
   â”‚     â””â”€ code                       â”‚  â”œâ”€ total: 45.3
   â”œâ”€ intervention                     â”‚  â””â”€ items: [... 10 items]
   â”‚  â”œâ”€ id                            â”œâ”€ siteConsumption:
   â”‚  â”œâ”€ date                          â”‚  â”œâ”€ totalServiceHours: 486.1
   â”‚  â”œâ”€ machine                       â”‚  â”œâ”€ totalFragHours: 45.3
   â”‚  â”‚  â”œâ”€ id                         â”‚  â””â”€ items: [... 50 items]
   â”‚  â”‚  â”œâ”€ name                       â””â”€ mÃ©tadonnÃ©es
   â”‚  â”‚  â”œâ”€ code                          â”œâ”€ calculatedAt: "2024..."
   â”‚  â”‚  â”œâ”€ is_mere                       â””â”€ version: "1.0"
   â”‚  â”‚  â””â”€ equipement_mere
   â”‚  â”‚     â”œâ”€ id
   â”‚  â”‚     â”œâ”€ name
   â”‚  â”‚     â””â”€ code
   â”‚  â””â”€ ...
   â””â”€ ... Ã— 5000

Total : ~500KB              Total : ~5KB
         (100%)                     (1%)

Reduction : 99% âœ…
```

---

## ğŸ” Structure de la rÃ©ponse API

```javascript
// GET /api/service/metrics?startDate=...&endDate=...
// Response 200 OK
{
  // Charge du service vs capacitÃ©
  "chargePercent": 50.6,
  
  // RÃ©partition du temps (heures)
  "timeBreakdown": {
    "PROD": 240.5,      // Production/Fabrication
    "DEP": 80.2,        // DÃ©pannage
    "PILOT": 120.1,     // Pilotage/PrÃ©ventif
    "FRAG": 45.3,       // Fragmentation
    "total": 486.1
  },
  
  // MÃ©trique supplÃ©mentaire
  "shortActionsPercent": 4.2,
  
  // Top 10 causes de fragmentation
  "fragmentation": {
    "total": 45.3,      // Total FRAG heures
    "items": [
      {
        "subcategoryId": 5,
        "subcategoryName": "Support",
        "totalHours": 15.5,
        "actionCount": 23,
        "percent": 34
      },
      {
        "subcategoryId": 8,
        "subcategoryName": "RÃ©union",
        "totalHours": 12.2,
        "actionCount": 18,
        "percent": 27
      },
      // ... 8 more (Top 10)
    ]
  },
  
  // Consommation par Ã©quipement/site
  "siteConsumption": {
    "totalServiceHours": 486.1,
    "totalFragHours": 45.3,
    "items": [
      {
        "equipmentId": 1,
        "equipmentName": "Site A",
        "equipmentCode": "SITE-A",
        "totalHours": 250.5,
        "fragHours": 20.2,
        "percentTotal": 51.5,
        "percentFrag": 44.6
      },
      {
        "equipmentId": 2,
        "equipmentName": "Site B",
        "equipmentCode": "SITE-B",
        "totalHours": 150.3,
        "fragHours": 15.1,
        "percentTotal": 30.9,
        "percentFrag": 33.3
      },
      // ... ~48 more sites
    ]
  },
  
  // MÃ©tadonnÃ©es
  "metadata": {
    "calculatedAt": "2024-01-24T14:30:00Z",
    "version": "1.0",
    "period": {
      "startDate": "2024-01-01T00:00:00Z",
      "endDate": "2024-01-24T23:59:59Z",
      "days": 24
    }
  }
}
```

---

## âœ… RÃ©sumÃ©

**3 diagrammes clÃ©s** :
1. **Avant/AprÃ¨s** : Visualiser la diffÃ©rence
2. **Timeline** : Comprendre les gains
3. **Flux donnÃ©es** : Voir oÃ¹ va la complexitÃ©

**Conclusion** : DÃ©placer au backend = 5x plus rapide, 100x moins de donnÃ©es ğŸš€
